for i,v in pairs(getconnections(game:GetService("ScriptContext").Error)) do
    v:Disable()
end
Codex_Client = {SavedSettings = false}
if isfolder and makefolder and not isfolder('Codex') then
    makefolder('Codex')
    Codex_Client.SaveSettings = true
    if isfile('Codex/Codex_'..tostring(Game.PlaceId)..'.CODEX') then
        Codex_Client.SavedSettings = true
        Codex_Client.GameSettings = game:GetService('HttpService'):JSONDecode(readfile('Codex/Codex_'..tostring(Game.PlaceId)..'.CODEX'))
    end
elseif isfolder('Codex') then
    Codex_Client.SaveSettings = true
    if isfile('Codex/Codex_'..tostring(Game.PlaceId)..'.CODEX') then
        Codex_Client.SavedSettings = true
        Codex_Client.GameSettings = game:GetService('HttpService'):JSONDecode(readfile('Codex/Codex_'..tostring(Game.PlaceId)..'.CODEX'))
    end
else
    Codex_Client.SaveSettings = false
end


local lib = loadstring(game:HttpGet("https://robloxexploits.net/uilibcodex.txt"))()
main = lib:CreateWindow('Arsenal | Idev is sexy man')
Aimbotz = main:CreateTab('Aimbot')
Combat = main:CreateTab('Combat')
MainWindow = main:CreateTab('LocalPlayer')
Esp = main:CreateTab('Esp')

IsUpToDate = pcall(function()
    Client = {
        Toggles = {
            SilentAim = Codex_Client.SavedSettings and Codex_Client.GameSettings.Toggles.SilentAim or false,
            FOV = Codex_Client.SavedSettings and Codex_Client.GameSettings.Toggles.FOV or false,
            NoRecoil = Codex_Client.SavedSettings and Codex_Client.GameSettings.Toggles.NoRecoil or false,
            Fly = Codex_Client.SavedSettings and Codex_Client.GameSettings.Toggles.Fly or false,
            BHOP = Codex_Client.SavedSettings and Codex_Client.GameSettings.Toggles.BHOP or false,
            BoxEsp = Codex_Client.SavedSettings and Codex_Client.GameSettings.Toggles.BoxEsp or false,
            TracerEsp = Codex_Client.SavedSettings and Codex_Client.GameSettings.Toggles.TracerEsp or false,
            ShowTeam = Codex_Client.SavedSettings and Codex_Client.GameSettings.Toggles.ShowTeam or false,
            Rainbow =  Codex_Client.SavedSettings and Codex_Client.GameSettings.Toggles.Rainbow or false,
            Rainbow2 = Codex_Client.SavedSettings and Codex_Client.GameSettings.Toggles.Rainbow2 or false,
            Wallbang = Codex_Client.SavedSettings and Codex_Client.GameSettings.Toggles.Wallbang or false,
            RapidFire = Codex_Client.SavedSettings and Codex_Client.GameSettings.Toggles.RapidFire or false,
            KillAura = Codex_Client.SavedSettings and Codex_Client.GameSettings.Toggles.KillAura or false,
            JumpPower = Codex_Client.SavedSettings and Codex_Client.GameSettings.Toggles.JumpPower or false,
            NoSpread = Codex_Client.SavedSettings and Codex_Client.GameSettings.Toggles.NoSpread or false,
        },
        Visuals = {
            BoxEsp = false,
            TracerEsp = false,
            Names = false,
            TeamCheck = true,
            EnemyColor = Color3.fromRGB(255,0,0),
            TeamColor = Color3.fromRGB(0,255,0),
            ShowTeam = false,
            Rainbow = false,
            Rainbow2 = false
        },
        Values = {
            AimPart = Codex_Client.SavedSettings and Codex_Client.GameSettings.Values.AimPart or "Head",
            FOV = Codex_Client.SavedSettings and Codex_Client.GameSettings.Values.FOV or 100,
            ChatMsg = Codex_Client.SavedSettings and Codex_Client.GameSettings.Values.ChatMsg or "Codex Winning",
            ChatDelay = Codex_Client.SavedSettings and Codex_Client.GameSettings.Values.ChatDelay or 1,
            Speed = Codex_Client.SavedSettings and Codex_Client.GameSettings.Values.Speed or 2,
            JumpPower = Codex_Client.SavedSettings and Codex_Client.GameSettings.Values.JumpPower or 36
        }
    }
end)
if not IsUpToDate and Codex_Client.SavedSettings and isfile('CODEX/CODEX_'..tostring(Game.PlaceId)..'.CODEX') then
    delfile('Codex/Codex_'..tostring(Game.PlaceId)..'.CODEX')
    game.Players.LocalPlayer:Kick('Codex Expirenced an unexpected issue with savefile | Restart Codex to Continue')
end
Main = require(game:GetService("ReplicatedStorage"):WaitForChild("TS"));


MainWindow:CreateToggle("Fly", Client.Toggles.Fly,function(state)
    Client.Toggles.Fly = state
end)


local TS = require(game:GetService("ReplicatedStorage"):WaitForChild("TS"));
local Timer = TS.Timer
local Control = getupvalue(Timer.BindToHeartbeat,1)['Control']

MainWindow:CreateSlider("Sprint Speed",Client.Values.Speed, 2, 10, function(num)
    Client.Values.Speed = num
    setconstant(Control,tonumber(table.find(getconstants(Control),'Stand'))+1,num)
end)
MainWindow:CreateToggle("JumpPower", Client.Toggles.JumpPower, function(state)
    Client.Toggles.JumpPower = state 
end)
MainWindow:CreateSlider("JumpPower", Client.Values.JumpPower,0, 150, function(num)
    Client.Values.JumpPower = num
end)
OldVECTOR3 = hookfunction(getrenv().Vector3.new,function(...)
    if Client.Toggles.JumpPower == true and tostring(getfenv(2).script) == 'ControlScript' then
        local Args = {...}
        local Me = Main.Characters:GetCharacter(game.Players.LocalPlayer)
        if Me and Args[1] == Me.Root.Velocity.X then
            return OldVECTOR3(Me.Root.Velocity.X,100,Me.Root.Velocity.Y)
        end
    end
    return OldVECTOR3(...)
end)

Combat:CreateToggle("No Recoil", Client.Toggles.NoRecoil,function(state)
    Client.Toggles.NoRecoil = state
end)
--[[
Combat:CreateToggle("Rapid Fire",Client.Toggles.RapidFire, function(state)
    Client.Toggles.RapidFire = state
end)
]]
Combat:CreateToggle("No Spread",Client.Toggles.NoSpread, function(state)
    Client.Toggles.NoSpread = state
end)


Combat:CreateToggle("Wallbang (20m Close Range)", Client.Toggles.Wallbang,function(state)
    Client.Toggles.Wallbang = state
    local Raycast = require(game:GetService("ReplicatedStorage").TS).Raycast
    if state == true then
        debug.setupvalue(Raycast.CastGeometryAndEnemies, 1, nil)
        debug.setupvalue(Raycast.CastGeometryAndEnemies, 2, nil)
    else
        debug.setupvalue(Raycast.CastGeometryAndEnemies, 1, game:GetService('Workspace').Geometry)
        debug.setupvalue(Raycast.CastGeometryAndEnemies, 2, game:GetService('Workspace').Terrain)
    end
end)

MainWindow:CreateToggle('Chat Spam',Client.Toggles.SpamChat,function(state)
    Client.Toggles.SpamChat = state
end)

MainWindow:CreateTextbox(
	"Chat Message",
	function(Text)
		Client.Values.ChatMsg = tostring(Text)
	end
)


spawn(function()
    while true do
        wait(Client.Values.ChatDelay)
        if Client.Toggles.SpamChat == true then
            game:GetService("ReplicatedStorage").DefaultChatSystemChatEvents.SayMessageRequest:FireServer(Client.Values.ChatMsg, "ALL")
            wait(.1)
        end
    end
end)

MainWindow:CreateSlider("Chat Delay",Client.Values.ChatDelay, 0, 10, function(num)
    Client.Values.ChatDelay = num
end)

game:GetService('UserInputService').InputBegan:connect(function(key, gpe)
    if key.KeyCode == Enum.KeyCode.LeftShift then
        Temp_Up = true
    end
    if key.KeyCode == Enum.KeyCode.LeftControl then
        Temp_Down = true
    end
end)
game:GetService('UserInputService').InputEnded:connect(function(key, gpe)
    if key.KeyCode == Enum.KeyCode.LeftShift then
        Temp_Up = false
    end
    if key.KeyCode == Enum.KeyCode.LeftControl then
        Temp_Down = false
    end
end)
spawn(function()
    while true do
        wait()
        pcall(function()
            if Client.Toggles.KillAura then
                for i,v in pairs(GetCharacters()) do
                    local Me = Main.Characters:GetCharacter(game.Players.LocalPlayer)
                    if Me and v.Hitbox and (v.Hitbox.Chest.Position - game.Workspace.CurrentCamera.CFrame.p).Magnitude < 25 then
                        if Me.Backpack.Equipped ~= Me:FindFirstChild('Stab',true).Parent.Parent then
                            game:GetService("ReplicatedStorage"):FindFirstChild('Item',true):FireServer("Equip", Me:FindFirstChild('Stab',true).Parent.Parent)   
                        end
                        local v1 = "Stab"
                        local v2 = Me:FindFirstChild('Stab',true).Parent.Parent
                        local v3 = v.Hitbox.Chest
                        local v4 = Vector3.new()
                        local v5 = Vector3.new()
                        local event = game:GetService("ReplicatedStorage"):FindFirstChild('Item_Melee',true)
                        
                        event:FireServer(v1, v2, v3, v4, v5)
                    end
                end
            end
            if Client.Toggles.Fly == true then
                game:GetService("Workspace").Gravity = 0
                Me = Main.Characters:GetCharacter(game.Players.LocalPlayer)
                if Temp_Up == true then
                    Me.Root.Velocity = Vector3.new(0,40,0)
                end
                if Temp_Down == true then
                    Me.Root.Velocity = Vector3.new(0,-40,0)
                end
                if Temp_Down == false and Temp_Up == false then
                    if Me.Root.Velocity.Y ~= 0 then
                        Me.Root.Velocity = Vector3.new(0,0,0)
                    end
                end
            else
                game:GetService("Workspace").Gravity = 110
            end
        end)
    end
end)


Aimbotz:CreateToggle("Silent-Aim",Client.Toggles.SilentAim, function(state)
    Client.Toggles.SilentAim = state
end)
Combat:CreateToggle("Auto Knife Aura",Client.Toggles.KillAura, function(state)
    Client.Toggles.KillAura = state
end)

Aimbotz:CreateToggle('FOV Visible',Client.Toggles.FOV,function(state)
    Client.Toggles.FOV = state
end)

Aimbotz:CreateSlider("FOV", Client.Values.FOV,15, 1000, function(num)
    Client.Values.FOV = num
end)

Aimbotz:CreateDropdown('BodyPart',false,{'Chest','Head','Random'},function(Sele)
    Client.Values.AimPart = Sele
end)
function GetAimPart()
    if Client.Values.AimPart == 'Random' then
        if math.random(1,3) == 1 then
            return 'Head'
        else
            return 'Chest'
        end
    else
        return Client.Values.AimPart
    end
end

--Visuals Below
--FOV
local FOVCircle = Drawing.new("Circle")
FOVCircle.Thickness = 2
FOVCircle.NumSides = 460
FOVCircle.Filled = false
FOVCircle.Transparency = 0.6
FOVCircle.Radius = Client.Values.FOV
FOVCircle.Color = Color3.new(0,255,0)

--Framework
local localPlayer = game:GetService("Players").LocalPlayer
local currentCamera = game:GetService("Workspace").CurrentCamera
local Mouse = localPlayer:GetMouse()
function GetCharacters()
    temptable = {}
        for i,v in pairs(game.Players:GetPlayers()) do
            if v.Name ~= game.Players.LocalPlayer.Name and Main.Teams:GetPlayerTeam(v) ~= Main.Teams:GetPlayerTeam(game.Players.LocalPlayer) then
                temp2 = Main.Characters:GetCharacter(v)
                table.insert(temptable,temp2)
            end
        end
    return temptable
end
function getClosestPlayerToCursor() 
    local closestPlayer = nil
    local shortestDistance = math.huge
        for i, v in pairs(GetCharacters()) do
            local pos = currentCamera:WorldToViewportPoint(v.Body.Head.Position)
            local magnitude = (Vector2.new(pos.X, pos.Y) - Vector2.new(Mouse.X, Mouse.Y)).magnitude
            if magnitude < shortestDistance and magnitude <= Client.Values.FOV then
                closestPlayer = v
                shortestDistance = magnitude
            end
        end  
    return closestPlayer
end
game:GetService("RunService").Stepped:Connect(function()
    FOVCircle.Position = game:GetService('UserInputService'):GetMouseLocation()
    FOVCircle.Radius = Client.Values.FOV
    if Client.Toggles.FOV == true then
        FOVCircle.Visible = true
    else
        FOVCircle.Visible = false
    end
end)

Camera = game.Workspace.CurrentCamera
local getcallingfunction = function(stack)
    return debug.getinfo(stack + 1).func
end
OldIndex = hookfunction(getrawmetatable(game).__index,function(...)
	local Self,Key = ...
	if tostring(Self) == 'Camera' and tostring(Key) == 'CFrame' and tostring(getfenv(2).script) == 'ItemControlScript' then
	    if Client.Toggles.SilentAim and getClosestPlayerToCursor() and tostring(debug.getinfo(getcallingfunction(3)).name) == 'LookVector' then
		    local target = getClosestPlayerToCursor()
            if target then
                Camera = game.Workspace.CurrentCamera
                if target.Body and target.Body:FindFirstChild(GetAimPart()) then
                    Camera = {
                        CFrame = CFrame.new(Camera.CFrame.p,target.Body[GetAimPart()].Position)
                    }
                end
                return (Camera.CFrame)
            end
		end
	end
	return OldIndex(...)
end)
OldRANDOM = hookfunction(getrenv().math.random,function(...)
    local Args = {...}
    if tostring(getfenv(2).script) == 'ItemControlScript' and Client.Toggles.NoSpread then
        if math.abs(Args[1]) == Args[2] then
            Args[1] = -0.1
            Args[2] = 0.1
            return OldRANDOM(unpack(Args))
        end
    end
    return OldRANDOM(...)
end)

OldRecoil = hookfunction(Main.Camera.Recoil.Update,function(p6, p7)
    if Client.Toggles.NoRecoil == true then
        return p6.Value - p6.LastValue;
    end
    return OldRecoil(p6,p7)
end)

--ESP 

Esp:CreateToggle('Boxes',Client.Toggles.BoxEsp,function(state)
    Client.Toggles.BoxEsp = state
end)

Esp:CreateToggle("Tracers", Client.Toggles.TracerEsp,function(state)
    Client.Toggles.TracerEsp = state
end)

Esp:CreateToggle("NameEsp",Client.Toggles.NameEsp, function(state)
    Client.Toggles.NameEsp = state
end)

Esp:CreateToggle("TeamEsp",Client.Toggles.ShowTeam, function(state)
    Client.Toggles.ShowTeam = state
end)

function DrawSquare()
    local Box = Drawing.new("Square")
    Box.Color = Color3.fromRGB(190, 190, 0)
    Box.Thickness = 0.5
    Box.Filled = false
    Box.Transparency = 1
    return Box
end

function DrawLine()
    local line = Drawing.new("Line")
    line.Color = Color3.new(190, 190, 0)
    line.Thickness = 0.5
    return line
end

function DrawText()
    local text = Drawing.new("Text")
    text.Color = Color3.fromRGB(190, 190, 0)
    text.Size = 20
    text.Outline = true
    text.Center = true
    return text
end

--Esp Loader

function AddEsp(player)
    local Box = DrawSquare()
    local Tracer = DrawLine()
    local Name = DrawText()
    game:GetService('RunService').Stepped:Connect(function()
        pcall(function()
            if Main.Characters:GetCharacter(player) == nil or Main.Characters:GetCharacter(player).Health.Value == 0 then
                Box.Visible = false
                Tracer.Visible = false
                Name.Visible = false
            else
                if Client.Toggles.ShowTeam then
                    if Client.Visuals.TeamCheck and Main.Teams:GetPlayerTeam(player) == Main.Teams:GetPlayerTeam(game.Players.LocalPlayer) then
                        Box.Color = Client.Visuals.TeamColor
                        Tracer.Color = Client.Visuals.TeamColor
                        Name.Color = Client.Visuals.TeamColor
                    else
                        Box.Color = Client.Visuals.EnemyColor
                        Tracer.Color = Client.Visuals.EnemyColor
                        Name.Color = Client.Visuals.EnemyColor
                    end
                    if Main.Characters:GetCharacter(player).Body:FindFirstChild("Chest") and player.InMenu.Value == false then
                        local RootPosition, OnScreen = game.Workspace.CurrentCamera:WorldToViewportPoint(Main.Characters:GetCharacter(player).Body.Chest.Position)
                        local HeadPosition = game.Workspace.CurrentCamera:WorldToViewportPoint(Main.Characters:GetCharacter(player).Body.Head.Position + Vector3.new(0, 0.5, 0))
                        local LegPosition = game.Workspace.CurrentCamera:WorldToViewportPoint(Main.Characters:GetCharacter(player).Body.Chest.Position - Vector3.new(0, 4, 0))
                        if Client.Toggles.BoxEsp then
                            Box.Visible = OnScreen
                            Box.Size = Vector2.new((2350 / RootPosition.Z) + 2.5, HeadPosition.Y - LegPosition.Y)
                            Box.Position = Vector2.new((RootPosition.X - Box.Size.X / 2) - 1, RootPosition.Y - Box.Size.Y / 2)
                        else
                            Box.Visible = false
                        end
                        if Client.Toggles.TracerEsp then
                            Tracer.Visible = OnScreen
                            Tracer.To = Vector2.new(game.Workspace.CurrentCamera.ViewportSize.X / 2, 1000)
                            Tracer.From = Vector2.new(game.Workspace.CurrentCamera:WorldToViewportPoint(Main.Characters:GetCharacter(player).Body.Chest.Position).X - 1, RootPosition.Y - (HeadPosition.Y - LegPosition.Y) / 2)
                        else
                            Tracer.Visible = false
                        end
                        if Client.Toggles.NameEsp then
                            Name.Visible = OnScreen
                            Name.Position = Vector2.new(game.Workspace.CurrentCamera:WorldToViewportPoint(Main.Characters:GetCharacter(player).Body.Head.Position).X, game.Workspace.CurrentCamera:WorldToViewportPoint(Main.Characters:GetCharacter(player).Body.Head.Position).Y - 40)
                            Name.Text = player.Name
                        else
                            Name.Visible = false
                        end
                    else
                        Box.Visible = false
                        Tracer.Visible = false
                        Name.Visible = false
                    end
                    if not player then
                        Box.Visible = false
                        Tracer.Visible = false
                        Name.Visible = false
                    end
                else
                    if Main.Teams:GetPlayerTeam(player) == Main.Teams:GetPlayerTeam(game.Players.LocalPlayer) then
                        Box.Visible = false
                        Tracer.Visible = false
                        Name.Visible = false
                    end
                    if Client.Visuals.TeamCheck and Main.Teams:GetPlayerTeam(player) ~= Main.Teams:GetPlayerTeam(game.Players.LocalPlayer) then
                        Box.Color = Client.Visuals.EnemyColor
                        Tracer.Color = Client.Visuals.EnemyColor
                        Name.Color = Client.Visuals.EnemyColor
                        if Main.Characters:GetCharacter(player).Body:FindFirstChild("Chest") and player.InMenu.Value == false then
                        local RootPosition, OnScreen = game.Workspace.CurrentCamera:WorldToViewportPoint(Main.Characters:GetCharacter(player).Body.Chest.Position)
                        local HeadPosition = game.Workspace.CurrentCamera:WorldToViewportPoint(Main.Characters:GetCharacter(player).Body.Head.Position + Vector3.new(0, 0.5, 0))
                        local LegPosition = game.Workspace.CurrentCamera:WorldToViewportPoint(Main.Characters:GetCharacter(player).Body.Chest.Position - Vector3.new(0, 4, 0))
                        if Client.Toggles.BoxEsp then
                            Box.Visible = OnScreen
                            Box.Size = Vector2.new((2350 / RootPosition.Z) + 2.5, HeadPosition.Y - LegPosition.Y)
                            Box.Position = Vector2.new((RootPosition.X - Box.Size.X / 2) - 1, RootPosition.Y - Box.Size.Y / 2)
                        else
                            Box.Visible = false
                        end
                        if Client.Toggles.TracerEsp then
                            Tracer.Visible = OnScreen
                            Tracer.To = Vector2.new(game.Workspace.CurrentCamera.ViewportSize.X / 2, 1000)
                            Tracer.From = Vector2.new(game.Workspace.CurrentCamera:WorldToViewportPoint(Main.Characters:GetCharacter(player).Body.Chest.Position).X - 1, RootPosition.Y - (HeadPosition.Y - LegPosition.Y) / 2)
                        else
                            Tracer.Visible = false
                        end
                        if Client.Toggles.NameEsp then
                            Name.Visible = OnScreen
                            Name.Position = Vector2.new(game.Workspace.CurrentCamera:WorldToViewportPoint(Main.Characters:GetCharacter(player).Body.Head.Position).X, game.Workspace.CurrentCamera:WorldToViewportPoint(Main.Characters:GetCharacter(player).Body.Head.Position).Y - 40)
                            Name.Text = player.Name
                        else
                            Name.Visible = false
                        end
                    else
                        Box.Visible = false
                        Tracer.Visible = false
                        Name.Visible = false
                    end
                        if not player then
                            Box.Visible = false
                            Tracer.Visible = false
                            Name.Visible = false
                        end
                    end
                end
            end
        end)
    end)
end
  
for i, v in pairs(game:GetService('Players'):GetPlayers()) do
    if v ~= game:GetService('Players').LocalPlayer then
        AddEsp(v)
    end
end
  
game:GetService('Players').PlayerAdded:Connect(function(player)
    if v ~= game:GetService('Players').LocalPlayer then
        AddEsp(player)
    end
end)


while true do wait(5)
    if Codex_Client.SaveSettings then
        writefile('Codex/Codex_'..tostring(Game.PlaceId)..'.CODEX',game:GetService('HttpService'):JSONEncode({['Toggles'] = Client.Toggles,['Values'] = Client.Values}))    
    end
end
